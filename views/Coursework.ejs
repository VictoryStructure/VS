<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Coursework</title>
	<link rel="stylesheet" href="css/HomeVS.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<link rel="icon" href="asset/ICON.png">
	<script src="js/CreateCoursework.js"></script>

</head>
<body>
<div class="wrapper">
    <div class="sidebar">
        <h2>Victory Structure</h2>
    	<ul>
            <li><a href="/">Home</a></li>
            <li><a href="/module">Module</a></li>
            <li><a href="/about"></i>About</a></li>

            <li><a href="/allcoursework"></i>All Coursework</a></li>
        </ul>
        <div class="options">
			<ul>
				<li><a href="#">Account and Settings</a></li>
				<li>
          <form action="/logout?_method=DELETE" method="POST">
            <button type="submit" class="linked_button">Log Out</button>
          </form>
        </li>
			</ul>
      </div>
    </div>
	
    <div class="main_content">
        <div class="header">All Coursework</div> 
		<div class ="button-group">
			<form action = "/createcoursework" method = "GET">
				<button class = "button1" type = "submit"> Create Coursework</button>
			</form>
			
		</div>
	
		<div class="info">
			<div id="selectContainer1">
				<script>
					$(document).ready(function(){
						let userid = <%= passedid %>;
						var data = <%-JSON.stringify(module_json)%>;
						var ddl = document.createElement("SELECT");
						$.each(data[userid],function(key, value){
							var option = document.createElement("OPTION");
							option.innerHTML = value.modulename;
							ddl.options.add(option);
						});
						document.getElementById('selectContainer1').appendChild(ddl);  
						ddl.setAttribute("name", "modulename");
					});
				</script>
			</div>
		
			<div class = "table">
			<table id = "coursework_table">
				<tr>
					<th data-column="coursework name" data-order="desc">Coursework Name</th>
					<th data-column="description" data-order="desc">Description</th>
					<th data-column="deadline" data-order="desc">Deadline</th>
					<th data-column="markvalue" data-order="desc">Markvalue</th>
					<th data-column="notes" data-order="desc">Notes</th>
					<th data-column="percentage" data-order="desc">Percentage</th>
					<th data-column="module" data-order="desc">Module</th>
				</tr>
			</table>
			</div>
		
			<script>
				var userid = <%= passedid %>;
				var jsondata = <%-JSON.stringify(coursework_json)%>;
				
				$('th').on('click', function(){
						var column = $(this).data('column')
						var order = $(this).data('order')
						console.log('Column was clicked', column, order)

					if (order == 'desc'){
						$(this).data("order", "asc")
						console.log(jsondata[userid])
						jsondata[userid] = jsondata[userid].sort((a,b) => a[column] > b[column] ? 1 : -1)
						
					}else{ 
						$(this).data("order", "desc")
						console.log(jsondata[userid])
						jsondata[userid] = jsondata[userid].sort((a,b) => a[column] < b[column] ? 1 : -1)
					}
					buildtable(jsondata);
				})

				buildtable(jsondata);

				function buildtable(data){
					$(document).ready(function(){
					var coursework_data = '';
					$.each(jsondata[userid],function(key, value){
						coursework_data += '<tr>';
						coursework_data += '<td>'+value.courseworkname+'</td>';
						coursework_data += '<td>'+value.description+'</td>';
						coursework_data += '<td>'+value.deadline+'</td>';
						coursework_data += '<td>'+value.markvalue+'</td>';
						coursework_data += '<td>'+value.notes+'</td>';
						coursework_data += '<td>'+value.percentage+'</td>';
						coursework_data += '<td>'+value.modulename+'</td>';
						coursework_data += '</tr>';
					});
					$('#coursework_table').append(coursework_data);
					table.innerHTML = '';
				});
				}
			</script>

			<form action="#" method="POST">
				<label for = "selectContainer">Select a Coursework</label>
				<div id="selectContainer2">
				<script>
					$(document).ready(function(){
						let userid = <%= passedid %>;
						var data = <%-JSON.stringify(coursework_json)%>;
						var ddl = document.createElement("SELECT");
						$.each(data[userid],function(key, value){
							var option = document.createElement("OPTION");
							option.innerHTML = value.courseworkname;
							ddl.options.add(option);
						});
						document.getElementById('selectContainer2').appendChild(ddl);  
						ddl.setAttribute("name", "selectpage");
					});
				</script>
				</div>
				<button type="submit" class="linked_button" id="form_submit">Submit</button>       
			</form> 
 			
		</div>
	</div>

    </div>
</div>
</body>
</html>